var Revive=function(t){var e={},i=t,n={},r={};this.clear=function(){return e={},this},this.setBroker=function(t){return i=t,this},this.emit=function(t,e,n,r){if(r)var c=i.subscribe({channel:t,topic:e+"_reply",callback:function(t,e){c.unsubscribe(),clearTimeout(a),r(t,e)}}),a=setTimeout(function(){c.unsubscribe()},3e4);return i.publish({channel:t,topic:e,data:n}),this},this.apply=function(t,e,i,n){return"function"==typeof i?c(t,e,i):a(t,e,i,n),this};var c=function(t,e,r){var c=i.subscribe({channel:t,topic:e,callback:function(t,e){var i=new d(e);r(t,i)}}),a=t+"."+e,s=n[a];s||(s=[]),s.push(c),n[a]=s},a=function(t,e,r,c){var a=i.subscribe({channel:t,topic:e,callback:function(t,e){var i=new d(e);c(t,i)}});a.identification=r;var s=t+"."+e,u=n[s];u||(u=[]),u.push(a),n[s]=u};this.unapply=function(t,e,i){return i?u(t,e,i):s(t,e),this};var s=function(t,e){try{var i=t+"."+e,r=n[i];if(r)for(var c=0;c<r.length;c++)r[c].unsubscribe();n[i]=[]}catch(t){}},u=function(t,e,i){try{var r=n[t+"."+e];if(r)for(var c=0;c<r.length;c++){var a=r[c];if(a.identification===i){a.unsubscribe(),r.splice(c,1);break}}}catch(t){}};this.publish=function(t,e){return r[t]=e,this},this.getRecord=function(t){return r[t]},this.on=function(t,e,i){var n=$("#"+t);return n.on(e,function(t){"click"===e&&n.attr("disabled")?t.preventDefault():(i(t),t.preventDefault())}),this},this.asState=function(t){var e={},i=$("#"+t);return e.html=i.html(),e.text=i.text(),e.css=i.attr("style"),e.class=i.attr("class"),e.id=t,e.disabled=i.attr("disabled"),e.src=i.attr("src"),e.href=i.attr("href"),e.width=i.attr("width"),e.height=i.attr("height"),e.alt=i.attr("alt"),e.title=i.attr("title"),e.checked=i.attr("checked"),e.selected=i.attr("selected"),e},this.store=function(t,i){return e[t]=i,this},this.restoreAll=function(t){var i=e[t];try{i.forEach(function(t){h(t)})}catch(t){}return this},this.restore=function(t){var i=e[t];return h(i),this};var h=function(t){var e=t.id;t.html?o(e,t.html):t.text&&l(e,t.text),t.css&&f(e,t.css),v(e,"class",t.class),v(e,"src",t.src),v(e,"href",t.href),v(e,"width",t.width),v(e,"height",t.height),v(e,"alt",t.alt),v(e,"title",t.title),v(e,"disabled",t.disabled),v(e,"checked",t.checked),v(e,"selected",t.selected)},o=function(t,e){$("#"+t).html(e)},l=function(t,e){$("#"+t).text(e)},f=function(t,e){$("#"+t).css(e)},v=function(t,e,i){var n=$("#"+t);i?n.attr(e,i):n.removeAttr(e)},d=function(t){return{channel:t.channel,topic:t.topic,timeStamp:t.timeStamp,data:t.data,reply:function(e){i.publish({channel:t.channel,topic:t.topic+"_reply",data:e})}}}};revive=new Revive(this.postal),function(){var t=document.querySelectorAll("[revive-data]");if(t)for(var e=0;e<t.length;e++){var i=t[e].getAttribute("revive-data"),n=t[e].getAttribute("revive-fn"),r=t[e].getAttribute("id"),c=t[e].getAttribute("revive-type");if(n)revive.on(r,c,function(t){var e=window[n];"function"==typeof e&&(e(t,i),t.preventDefault())});else{var a=JSON.parse(i);revive.on(r,c,function(t){revive.emit(a.channel,a.topic,a.data)})}}}();
